/**
 * Roundcube functions for default skin interface
 *
 * Copyright (c) 2013, The Roundcube Dev Team
 *
 * The contents are subject to the Creative Commons Attribution-ShareAlike
 * License. It is allowed to copy, distribute, transmit and to adapt the work
 * by keeping credits to the original autors in the README file.
 * See http://creativecommons.org/licenses/by-sa/3.0/ for details.
 */


function rcube_mail_ui(){function e(e,t){F[e]=t}function t(e){if(U||(U=window.localStorage?rcmail.local_storage_get_item("prefs.larry",{}):{}),null==U[e]){var t=rcmail.get_cookie(e);null!=t&&(U[e]=t,window.localStorage&&(rcmail.local_storage_set_item("prefs.larry",U),rcmail.set_cookie(e,t,new Date)))}return U[e]}function s(e,t){if(U[e]=t,window.localStorage)rcmail.local_storage_set_item("prefs.larry",U);else{var i=new Date;i.setYear(i.getFullYear()+1),rcmail.set_cookie(e,t,i)}}function a(){if(rcmail.addEventListener("message",l),$("#taskbar a").each(function(e,t){$(t).append('<span class="tooltip">'+$(".button-inner",this).html()+"</span>")}),$("#taskbar .minmodetoggle").click(function(){var e=$(document.body).toggleClass("minimal").hasClass("minimal");s("minimalmode",e?1:0),$(window).resize()}),"mail"==rcmail.env.task){rcmail.addEventListener("menu-open",x).addEventListener("menu-save",y).addEventListener("responseafterlist",function(){k(rcmail.env.threading?"thread":"list")});var e=$("#dragmessagemenu");if(e.length&&(rcmail.gui_object("dragmenu","dragmessagemenu"),Y.dragmenu=e),"show"==rcmail.env.action||"preview"==rcmail.env.action)rcmail.addEventListener("enable-command",u).addEventListener("aftershow-headers",function(){r()}).addEventListener("afterhide-headers",function(){r()}),$("#previewheaderstoggle").click(function(){return _(),!1}),$("#attachment-list > li").each(function(){$(this).append($('<a class="drop"></a>').click(function(){C(this)}))}),"1"==t("previewheaders")&&_();else if("compose"==rcmail.env.action){rcmail.addEventListener("aftersend-attachment",S).addEventListener("add-recipient",function(e){W(e.field,!0)}).addEventListener("aftertoggle-editor",function(e){window.setTimeout(function(){h()},200),e&&e.mode&&$("select[name='editorSelector']").val(e.mode)});var i,a,f,g=["cc","bcc","replyto","followupto"];for(i=0;i<g.length;i++)a=g[i],f=$("#_"+a),f.length&&(f.on("change",{v:a},function(e){this.value&&W(e.data.v,!0)}),""!=f.val()&&W(a,!0));$("#composeoptionstoggle").click(function(){return $("#composeoptionstoggle").toggleClass("remove"),$("#composeoptions").toggle(),h(),s("composeoptions",$("#composeoptions").is(":visible")?"1":"0"),!1}).css("cursor","pointer"),"0"!==t("composeoptions")&&$("#composeoptionstoggle").click(),$("textarea[name='_to'], textarea[name='_cc'], textarea[name='_bcc']").change(function(){p(this)}).change(),rcmail.addEventListener("autocomplete_insert",function(e){p(e.field)});var w=rcmail.opener();w&&"compose"==w.env.action&&$("#composeoptionstoggle",opener.document).hasClass("remove")&&$("#composeoptionstoggle").click(),new rcube_splitter({id:"composesplitterv",p1:"#composeview-left",p2:"#composeview-right",orientation:"v",relative:!0,start:248,min:170,size:12,render:h}).init()}else if("list"!=rcmail.env.action&&rcmail.env.action)"get"==rcmail.env.action&&new rcube_splitter({id:"mailpartsplitterv",p1:"#messagepartheader",p2:"#messagepartcontainer",orientation:"v",relative:!0,start:226,min:150,size:12}).init();else{var z=$("#mailpreviewframe").is(":visible");$("#mailpreviewtoggle").addClass(z?"enabled":"closed").click(function(e){return b(e),!1}),$("#maillistmode").addClass(rcmail.env.threading?"":"selected").click(function(){return k("list"),!1}),$("#mailthreadmode").addClass(rcmail.env.threading?"selected":"").click(function(){return k("thread"),!1}),O=new rcube_splitter({id:"mailviewsplitter",p1:"#mailview-top",p2:"#mailview-bottom",orientation:"h",relative:!0,start:310,min:150,size:12,offset:4}),z&&O.init(),rcmail.addEventListener("setquota",m).addEventListener("enable-command",u).addEventListener("afterimport-messages",S)}$("#mailview-left").length&&new rcube_splitter({id:"mailviewsplitterv",p1:"#mailview-left",p2:"#mailview-right",orientation:"v",relative:!0,start:226,min:150,size:12,callback:c,render:d}).init()}else if("settings"==rcmail.env.task)rcmail.addEventListener("init",function(){var e="#settingstabpreferences";rcmail.env.action&&(e="#settingstab"+(rcmail.env.action.indexOf("identity")>0?"identities":rcmail.env.action.replace(/\./g,""))),$(e).addClass("selected").children().first().removeAttr("onclick").click(function(){return!1})}),"folders"==rcmail.env.action?(new rcube_splitter({id:"folderviewsplitter",p1:"#folderslist",p2:"#folder-details",orientation:"v",relative:!0,start:266,min:180,size:12}).init(),new rcube_scroller("#folderslist-content","#folderslist-header","#folderslist-footer"),rcmail.addEventListener("setquota",m)):"identities"==rcmail.env.action?new rcube_splitter({id:"identviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:!0,start:266,min:180,size:12}).init():"responses"==rcmail.env.action?new rcube_splitter({id:"responseviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:!0,start:266,min:180,size:12}).init():"preferences"!=rcmail.env.action&&rcmail.env.action?"edit-prefs"==rcmail.env.action&&($('<a href="#toggle">&#9660;</a>').addClass("advanced-toggle").appendTo("#preferences-details fieldset.advanced legend"),$("#preferences-details fieldset.advanced legend").click(function(){{var e=$(this).hasClass("collapsed");$(".advanced-toggle",this).html(e?"&#9650;":"&#9660;")}$(this).toggleClass("collapsed").closest("fieldset").children(".propform").toggle()}).addClass("collapsed")):new rcube_splitter({id:"prefviewsplitter",p1:"#sectionslist",p2:"#preferences-box",orientation:"v",relative:!0,start:266,min:180,size:12}).init();else if("addressbook"==rcmail.env.task){rcmail.addEventListener("afterupload-photo",S).addEventListener("beforepushgroup",M).addEventListener("beforepopgroup",H),""==rcmail.env.action&&(new rcube_splitter({id:"addressviewsplitterd",p1:"#addressview-left",p2:"#addressview-right",orientation:"v",relative:!0,start:226,min:150,size:12,render:d}).init(),new rcube_splitter({id:"addressviewsplitter",p1:"#addresslist",p2:"#contacts-box",orientation:"v",relative:!0,start:286,min:270,size:12}).init());var e=$("#dragcontactmenu");e.length&&(rcmail.gui_object("dragmenu","dragcontactmenu"),Y.dragmenu=e)}$(".tabbed").each(function(e,t){j(t)}),$("select.decorated").each(function(){if(bw.opera)return void $(this).removeClass("decorated");var e=$(this),t=e.parent(),i=Math.max(e.height(),26)-2,s=e.width()-22,a=$("option",this).first().text();""!=$("option:selected",this).val()&&(a=$("option:selected",this).text());var o=$('<a class="menuselector"><span class="handle">'+a+"</span></a>").css("position","absolute").offset(e.position()).insertAfter(e);o.children().width(s).height(i).css("line-height",i-1+"px"),"absolute"!=t.css("position")&&t.css("position","relative"),e.width(o.width()).change(function(){var e=$("option:selected",this).text();$(this).next().children().text(e)})});var T=$("body > div.minwidth");T.length&&T.css("min-width",$(".toolbar").width()+$("#quicksearchbar").width()+$("#searchfilter").width()+30),$(document.body).bind("mouseup",o).bind("keyup",function(e){if(27==e.keyCode)for(var t in Y)Y[t].is(":visible")&&v(t,!1)}),$("iframe").load(function(){try{var e=this.contentDocument?this.contentDocument:this.contentWindow?this.contentWindow.document:null;$(e).mouseup(o)}catch(t){}}).contents().mouseup(o),window.onresize=n,n()}function o(e){var t,i,s=e.target;"inner"==s.className&&(s=e.target.parentNode);for(var a in Y)if(i=Y[a],t=B[a],!(!i.is(":visible")||s.id==a+"link"||s==i.get(0)||t.toggle||t.editable&&w(s,i.get(0))||t.sticky&&rcube_mouse_is_over(e,i.get(0))||$(s).is(".folder-selector-link"))){var o=a+"";window.setTimeout(function(){g(o,!1)},10)}}function n(e){var t=e?10:0;rcmail.resize_timeout&&window.clearTimeout(rcmail.resize_timeout),rcmail.resize_timeout=window.setTimeout(function(){"mail"==rcmail.env.task&&("show"==rcmail.env.action||"preview"==rcmail.env.action?r():"compose"==rcmail.env.action&&h()),$("body.iframe .footerleft").each(function(){var e=$(this),t=$(document.body),i=e.hasClass("floating"),s=t.outerHeight(!0)>$(window).height();if(s!=i){var a=s?"addClass":"removeClass";e[a]("floating"),t[a]("floatingbuttons")}})},t)}function l(e){var t=$(e.object).siblings("div");if(t.length&&$(e.object).insertBefore(t.first()),"error"==e.type&&"login"!=rcmail.env.task){rcmail.hide_message(e.object),R.message_timer&&window.clearTimeout(R.message_timer),R.messagedialog||(R.messagedialog=$("<div>").addClass("popupdialog").hide());var i=e.message,s=function(){R.messagedialog.is(":visible")&&R.messagedialog.dialog("destroy").hide()};R.messagedialog.is(":visible")&&(i=R.messagedialog.html()+"<p>"+e.message+"</p>"),R.messagedialog.html(i).dialog({resizable:!1,closeOnEscape:!0,dialogClass:"popupmessage "+e.type,title:F.errortitle,close:s,position:["center","center"],hide:{effect:"fadeOut"},width:420,minHeight:90}).show(),e.timeout>0&&(R.message_timer=window.setTimeout(s,e.timeout))}}function r(){$("#messagecontent").css("top",$("#messageheader").outerHeight()+1+"px"),$("#message-objects div a").addClass("button"),$("#attachment-list li").length||($("div.rightcol").hide(),$("div.leftcol").css("margin-right","0"))}function c(){}function d(){}function p(e){if("TEXTAREA"==e.nodeName){var t=$(e),i=14,s=e.scrollHeight,a=e.value.length>80&&s>1.5*i?2:1;t.css("height",i*a+"px"),h()}}function h(){var e,t,i,s,a=$("#composebody"),o=$("#compose-content"),n=$("#composeview-bottom"),l=0,r=300,i=o.height()-n.position().top;s=r-i,l=s>-100?0:40,o.css("overflow",s>0?"auto":"hidden"),e=a.parent().width()-5,t=a.parent().height()-16,a.width(e).height(t),$("#composebody_tbl").width(e+8+"px").height("").css("margin-top","1px"),$("#composebody_ifr").width(e+8+"px").height(t-40+"px"),$("#googie_edit_layer").height(t+"px")}function m(e){var t=24,i=20,s=e.total?Math.ceil(e.percent/100*i)*t:0;e.total&&s==t*i&&e.percent<100&&(s-=t),$("#quotadisplay").css("background-position","0 -"+s+"px")}function u(e){if("reply-list"==e.command&&1==rcmail.env.reply_all_mode){var t=rcmail.gettext(e.status?"replylist":"replyall");"preview"==rcmail.env.action?$("a.button.replyall").attr("title",t):$("a.button.reply-all").text(t).attr("title",t)}}function f(e,t){var i=Y[e]=$("#"+e);i.appendTo(document.body),i.length&&(B[e]=$.extend(B[e]||{},t||{}))}function v(e,t,i){(i||!B[e])&&f(e,i);var s=g(e,t),i=B[e];"function"==typeof i.callback&&i.callback(s)}function g(e,t){{var i=Y[e],s=B[e],a=$(s.link?s.link:"#"+e+"link");s.above}if(i||(i=Y[e]=$("#"+e),i.appendTo(document.body)),!i||!i.length)return!1;if("undefined"==typeof t?t=i.is(":visible")?!1:!0:s.toggle&&t&&i.is(":visible")&&(t=!1),t&&a.length){var o=$(document).width()-80,n=40;o>300&&(o=300,n=($(document).width()-o)/2),i.css({left:n,top:50,width:o,height:$(document).height()-100})}return i[t?"show":"hide"](),bw.ie6&&s.overlap&&($("select").css("visibility",t?"hidden":"inherit"),$("select",i).css("visibility","inherit")),t}function w(e,t){for(;e.parentNode;){if(e.parentNode==t)return!0;e=e.parentNode}return!1}function b(e){{var i,s=$(e.target),a=$("#mailpreviewframe"),o=!a.is(":visible");O.pos||parseInt(t("mailviewsplitter")||320)}a.toggle(),s.removeClass().addClass(o?"enabled":"closed"),o?($("#mailview-top").removeClass("fullheight").css({bottom:"auto"}),$("#mailview-bottom").css({height:"auto"}).show(),rcmail.env.contentframe="messagecontframe",(i=rcmail.message_list.get_single_selection())&&rcmail.show_message(i,!1,!0),O.handle?(O.handle.show(),O.resize()):O.init()):(rcmail.env.contentframe=null,rcmail.show_contentframe(!1),$("#mailview-top").addClass("fullheight").css({height:"auto",bottom:"0px"}),$("#mailview-bottom").css({top:"auto",height:"0px"}).hide(),O.handle&&O.handle.hide()),rcmail.message_list&&(o&&i&&rcmail.message_list.scrollto(i),rcmail.message_list.resize()),rcmail.command("save-pref",{name:"preview_pane",value:o?1:0})}function _(){$("#preview-shortheaders").toggle();var e=$("#preview-allheaders").toggle(),t=$("a#previewheaderstoggle");e.is(":visible")?t.attr("href","#hide").removeClass("add").addClass("remove"):t.attr("href","#details").removeClass("remove").addClass("add"),s("previewheaders",e.is(":visible")?"1":"0")}function k(e){rcmail.env.threading!=("thread"==e)&&rcmail.set_list_options(null,void 0,void 0,"thread"==e?1:0),$("#maillistmode, #mailthreadmode").removeClass("selected"),$("#mail"+e+"mode").addClass("selected")}function x(e){e&&e.props&&"attachmentmenu"==e.props.menu?g("attachmentmenu"):E()}function y(){L()}function z(e){if(e&&rcmail.env.search_mods){var t,i,s=Y.searchmenu,a=$('input:checkbox[name="s_mods[]"]',s),o=rcmail.env.mailbox,n=rcmail.env.search_mods;if("mail"==rcmail.env.task?(n=n[o]?n[o]:n["*"],i="text"):i="*",n[i])a.map(function(){this.checked=!0,this.disabled=this.value!=i});else{a.prop("disabled",!1).prop("checked",!1);for(t in n)$("#s_mod_"+t).prop("checked",!0)}}}function C(e){var t=e.parentNode.id.replace(/^attach/,"");$("#attachmenuopen").unbind("click").attr("onclick","").click(function(){return rcmail.command("open-attachment",t,this)}),$("#attachmenudownload").unbind("click").attr("onclick","").click(function(){rcmail.command("download-attachment",t,this)}),B.attachmentmenu.link=e,rcmail.command("menu-open",{menu:"attachmentmenu",id:t})}function T(){var e,t,s=rcmail.spellcheck_lang(),a=Y.spellmenu,o=$("ul",a);if(!o.length){o=$('<ul class="toolbarmenu selectable">');for(i in rcmail.env.spell_langs)t=$("<li>"),e=$('<a href="#"></a>').text(rcmail.env.spell_langs[i]).addClass("active").data("lang",i).click(function(){rcmail.spellcheck_lang_set($(this).data("lang"))}),e.appendTo(t),t.appendTo(o);o.appendTo(a)}$("li",o).each(function(){var e=$("a",this);e.data("lang")==s?e.addClass("selected"):e.hasClass("selected")&&e.removeClass("selected")})}function E(){var e=$("#listoptions");return e.is(":visible")?void e.dialog("close"):($('input[name="sort_col"][value="'+rcmail.env.sort_col+'"]').prop("checked",!0),$('input[name="sort_ord"][value="DESC"]').prop("checked","DESC"==rcmail.env.sort_order),$('input[name="sort_ord"][value="ASC"]').prop("checked","DESC"!=rcmail.env.sort_order),$('input[name="list_col[]"]').each(function(){$(this).prop("checked",-1!=$.inArray(this.value,rcmail.env.coltypes))}),void e.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:null,close:function(){e.dialog("destroy").hide()},minWidth:500,width:e.width()+25}).show())}function L(){$("#listoptions").dialog("close");var e=$('input[name="sort_col"]:checked').val(),t=$('input[name="sort_ord"]:checked').val(),i=$('input[name="list_col[]"]:checked').map(function(){return this.value}).get();rcmail.set_list_options(i,e,t,rcmail.env.threading)}function I(e){var t,i,s=rcmail.env.task,a=rcmail.env.search_mods,o=rcmail.env.mailbox;a||(a={}),"mail"==s?(a[o]||(a[o]=rcube_clone_object(a["*"])),i=a[o],t="text"):(i=a,t="*"),e.checked?i[e.value]=1:delete i[e.value],e.value==t&&$('input:checkbox[name="s_mods[]"]').map(function(){this!=e&&(this.checked=!0,e.checked?(this.disabled=!0,delete i[this.value]):(this.disabled=!1,i[this.value]=1))})}function M(){var e=$("#contacts-table"),t=e.parent().css("overflow","hidden");e.clone().css({position:"absolute",top:"0",left:"0",width:e.width()+"px","z-index":10}).appendTo(t).animate({left:-(e.width()+5)+"px"},300,"swing",function(){$(this).remove(),t.css("overflow","auto")})}function H(){var e=$("#contacts-table"),t=e.parent().css("overflow","hidden"),i=e.clone().appendTo(t);e.css({position:"absolute",top:"0",left:-(e.width()+5)+"px",width:e.width()+"px",height:e.height()+"px","z-index":10}).animate({left:"0"},300,"linear",function(){i.remove(),$(this).css({position:"relative",left:"0",width:"100%",height:"auto","z-index":1}),t.css("overflow","auto")})}function S(){var e=$("#upload-dialog");return e.is(":visible")?void e.dialog("close"):("compose"!=rcmail.env.action||e.data("extended")||($("<a>").addClass("iconlink add").attr("href","#add").html("Add").appendTo($('input[type="file"]',e).parent()).click(N),e.data("extended",!0)),e.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:e.attr("title"),close:function(){try{$("#upload-dialog form").get(0).reset()}catch(t){}e.dialog("destroy").hide(),$("div.addline",e).remove()},width:480}).show(),void(document.all||$("input[type=file]",e).first().click()))}function N(){var e=$(this).parent(),t=e.clone().addClass("addline").insertAfter(e);t.children(".iconlink").click(N),t.children("input").val(""),document.all||$("input[type=file]",t).click()}function W(e,t){var i=$("#compose-"+e);if(!i.is(":visible"))return X[e]&&!t&&$("#_"+e).val(X[e]),i.show(),$("#"+e+"-link").hide(),h(),!1}function A(e){var t=$("#_"+e);return X[e]=t.val(),t.val(""),$("#compose-"+e).hide(),$("#"+e+"-link").show(),h(),!1}function j(e,t){var i=$(e),s=i.get(0).id,a=i.children("fieldset");if(a.length){s||(s="rcmtabcontainer",i.attr("id",s)),t=t||0,a.each(function(e){e!=t&&$(this).hide()});var o=$("<div>").addClass("tabsbar").prependTo(i);a.each(function(e){var i,a,n=$(this),l=n.children("legend");a=$("<a>").text(l.text()).attr("href","#"),i=$("<span>").attr({id:"tab"+e,"class":"tablink"}).click(function(){return q(s,e),!1}),l.remove(),n.addClass("tab"),e==t&&i.addClass("selected"),i.append(a).appendTo(o)})}}function q(e,t){var i=$("#"+e).children("fieldset");i.each(function(e){$(this)[t==e?"show":"hide"](),$("#tab"+e).toggleClass("selected",e==t)}),n()}function D(e){var t=$("<iframe>").attr("id","aboutframe").attr("src",rcmail.url("settings/about")).attr("frameborder","0").appendTo(document.body),i=Math.floor(.75*$(window).height()),s={},a=$("#supportlink");a.length&&(F.supporturl=a.attr("href"))&&(s[a.html()]=function(){F.supporturl.indexOf("mailto:")<0?window.open(F.supporturl):location.href=F.supporturl}),t.dialog({modal:!0,resizable:!1,closeOnEscape:!0,title:e?e.title||e.innerHTML:null,close:function(){t.dialog("destroy").remove()},buttons:s,width:640,height:i}).width(640)}var O,U,F={},Y={},B={forwardmenu:{editable:1},searchmenu:{editable:1,callback:z},attachmentmenu:{},listoptions:{editable:1},dragmenu:{sticky:1},groupmenu:{above:1},mailboxmenu:{above:1},spellmenu:{callback:T},"attachment-form":{editable:1,above:1,toggle:!bw.ie&&!bw.linux},"upload-form":{editable:1,toggle:!bw.ie&&!bw.linux}},R=this,X={};if(this.set=e,this.init=a,this.init_tabs=j,this.show_about=D,this.show_popup=v,this.add_popup=f,this.set_searchmod=I,this.show_uploadform=S,this.show_header_row=W,this.hide_header_row=A,this.update_quota=m,this.get_pref=t,this.save_pref=s,window.$&&document.body){var G=t("minimalmode");(parseInt(G)||null===G&&$(window).height()<850)&&$(document.body).addClass("minimal"),bw.tablet&&$("#viewport").attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}}function rcube_scroller(e,t,i){var s=this;this.list=$(e),this.top=$(t),this.bottom=$(i),this.step_size=6,this.step_time=20,this.delay=500,this.top.mouseenter(function(){rcmail.drag_active&&(s.ts=window.setTimeout(function(){s.scroll("down")},s.delay))}).mouseout(function(){s.ts&&window.clearTimeout(s.ts)}),this.bottom.mouseenter(function(){rcmail.drag_active&&(s.ts=window.setTimeout(function(){s.scroll("up")},s.delay))}).mouseout(function(){s.ts&&window.clearTimeout(s.ts)}),this.scroll=function(e){var t=this,i=this.step_size;rcmail.drag_active&&("down"==e&&(i*=-1),this.list.get(0).scrollTop+=i,this.ts=window.setTimeout(function(){t.scroll(e)},this.step_time))}}function rcube_splitter(e){function t(){(bw.konq||bw.chrome||bw.safari)&&(document.body.style.webkitUserSelect="none"),n.p1pos=n.relative?n.p1.position():n.p1.offset(),n.p2pos=n.relative?n.p2.position():n.p2.offset(),n.drag_active=!0,$(document).bind("mousemove."+this.id,i).bind("mouseup."+this.id,a),$("iframe").each(function(e,t){$("<div>").attr("id","iframe-splitter-fix-"+e).addClass("iframe-splitter-fix").css({background:"#fff",width:t.offsetWidth+"px",height:t.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")})}function i(e){return n.drag_active?(window.clearTimeout(n.ts),n.ts=window.setTimeout(function(){s(e)},1),!1):!1}function s(e){var t=rcube_event.get_mouse_pos(e);if(n.relative){var i=n.p1.parent().offset();t.x-=i.left,t.y-=i.top}n.horizontal?t.y-n.halfsize>n.p1pos.top&&t.y+n.halfsize<n.p2pos.top+n.p2.outerHeight()&&(n.pos=Math.max(n.min,t.y-n.offset),n.resize()):t.x-n.halfsize>n.p1pos.left&&t.x+n.halfsize<n.p2pos.left+n.p2.outerWidth()&&(n.pos=Math.max(n.min,t.x-n.offset),n.resize()),n.p1pos=n.relative?n.p1.position():n.p1.offset(),n.p2pos=n.relative?n.p2.position():n.p2.offset()}function a(e){return(bw.konq||bw.chrome||bw.safari)&&(document.body.style.webkitUserSelect="auto"),$(document).unbind("."+n.id),n.drag_active=!1,$("div.iframe-splitter-fix").remove(),n.set_cookie(),"function"==typeof n.callback&&n.callback(n),bw.safari?!0:rcube_event.cancel(e)}function o(){if(n.horizontal){var e=parseInt(n.p2.parent().outerHeight(),10)-parseInt(n.p2[0].style.top,10)-(bw.ie8?2:0);n.p2.css("height",(e>0?e:0)+"px")}else{var t=parseInt(n.p2.parent().outerWidth(),10)-parseInt(n.p2[0].style.left,10);n.p2.css("width",(t>0?t:0)+"px")}}this.p=e,this.id=e.id,this.horizontal="horizontal"==e.orientation||"h"==e.orientation,this.halfsize=(void 0!==e.size?e.size:10)/2,this.pos=e.start||0,this.min=e.min||20,this.offset=e.offset||0,this.relative=e.relative?!0:!1,this.drag_active=!1,this.render=e.render,this.callback=e.callback;var n=this;rcube_splitter._instances[this.id]=n,this.init=function(){if(this.p1=$(this.p.p1),this.p2=$(this.p.p2),this.p1.length&&this.p2.length){if(this.p1pos=this.relative?this.p1.position():this.p1.offset(),this.p2pos=this.relative?this.p2.position():this.p2.offset(),this.handle=$("<div>").attr("id",this.id).attr("unselectable","on").addClass("splitter "+(this.horizontal?"splitter-h":"splitter-v")).appendTo(this.p1.parent()).bind("mousedown",t),this.horizontal){var e=this.p1pos.top+this.p1.outerHeight();this.handle.css({left:"0px",top:e+"px"})}else{var i=this.p1pos.left+this.p1.outerWidth();this.handle.css({left:i+"px",top:"0px"})}bw.ie&&$(window).resize(o);var s=this.get_cookie();s&&!isNaN(s)?(this.pos=parseFloat(s),this.resize()):this.pos&&(this.resize(),this.set_cookie())}},this.resize=function(){if(this.horizontal){if(this.p1.css("height",Math.floor(this.pos-this.p1pos.top-this.halfsize)+"px"),this.p2.css("top",Math.ceil(this.pos+this.halfsize+2)+"px"),this.handle.css("top",Math.round(this.pos-this.halfsize+this.offset)+"px"),bw.ie){var e=parseInt(this.p2.parent().outerHeight(),10)-parseInt(this.p2.css("top"),10)-(bw.ie8?2:0);this.p2.css("height",(e>0?e:0)+"px")}}else if(this.p1.css("width",Math.floor(this.pos-this.p1pos.left-this.halfsize)+"px"),this.p2.css("left",Math.ceil(this.pos+this.halfsize)+"px"),this.handle.css("left",Math.round(this.pos-this.halfsize+this.offset+3)+"px"),bw.ie){var t=parseInt(this.p2.parent().outerWidth(),10)-parseInt(this.p2.css("left"),10);this.p2.css("width",(t>0?t:0)+"px")}this.p2.resize(),this.p1.resize(),this.drag_active&&$("iframe").each(function(e,t){var i=$(this).offset();$("#iframe-splitter-fix-"+e).css({top:i.top+"px",left:i.left+"px",width:t.offsetWidth+"px",height:t.offsetHeight+"px"})}),"function"==typeof this.render&&this.render(this)},this.get_cookie=function(){return window.UI?UI.get_pref(this.id):null},this.set_cookie=function(){window.UI&&UI.save_pref(this.id,this.pos)}}rcube_splitter._instances={},rcube_splitter.get_instance=function(e){return rcube_splitter._instances[e]};

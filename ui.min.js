function rcube_mail_ui(){function f(t,n){e[t]=n}function l(e){if(!u){u=window.localStorage?rcmail.local_storage_get_item("prefs.larry",{}):{}}if(u[e]==null){var t=rcmail.get_cookie(e);if(t!=null){u[e]=t;if(window.localStorage){rcmail.local_storage_set_item("prefs.larry",u);rcmail.set_cookie(e,t,new Date)}}}return u[e]}function c(e,t){u[e]=t;if(window.localStorage){rcmail.local_storage_set_item("prefs.larry",u)}else{var n=new Date;n.setYear(n.getFullYear()+1);rcmail.set_cookie(e,t,n)}}function h(){rcmail.addEventListener("message",v);$("#taskbar a").each(function(e,t){$(t).append('<span class="tooltip">'+$(".button-inner",this).html()+"</span>")});$("#taskbar .minmodetoggle").click(function(e){var t=$(document.body).toggleClass("minimal").hasClass("minimal");c("minimalmode",t?1:0);$(window).resize()});if(rcmail.env.task=="mail"){rcmail.addEventListener("menu-open",O).addEventListener("menu-save",M).addEventListener("responseafterlist",function(e){A(rcmail.env.threading?"thread":"list")});var e=$("#dragmessagemenu");if(e.length){rcmail.gui_object("dragmenu","dragmessagemenu");t.dragmenu=e}if(rcmail.env.action=="show"||rcmail.env.action=="preview"){rcmail.addEventListener("enable-command",S).addEventListener("aftershow-headers",function(){m()}).addEventListener("afterhide-headers",function(){m()});$("#previewheaderstoggle").click(function(e){L();return false});$("#attachment-list > li").each(function(){$(this).append($('<a class="drop"></a>').click(function(){D(this)}))});if(l("previewheaders")=="1"){L()}}else if(rcmail.env.action=="compose"){rcmail.addEventListener("aftersend-attachment",q).addEventListener("add-recipient",function(e){U(e.field,true)}).addEventListener("aftertoggle-editor",function(e){window.setTimeout(function(){w()},200);if(e&&e.mode)$("select[name='editorSelector']").val(e.mode)});var n,r,i,o=["cc","bcc","replyto","followupto"];for(n=0;n<o.length;n++){r=o[n];i=$("#_"+r);if(i.length){i.on("change",{v:r},function(e){if(this.value)U(e.data.v,true)});if(i.val()!="")U(r,true)}}$("#composeoptionstoggle").click(function(){$("#composeoptionstoggle").toggleClass("remove");$("#composeoptions").toggle();w();c("composeoptions",$("#composeoptions").is(":visible")?"1":"0");return false}).css("cursor","pointer");if(l("composeoptions")!=="0"){$("#composeoptionstoggle").click()}$("textarea[name='_to'], textarea[name='_cc'], textarea[name='_bcc']").change(function(e){b(this)}).change();rcmail.addEventListener("autocomplete_insert",function(e){b(e.field)});var u=rcmail.opener();if(u&&u.env.action=="compose"&&$("#composeoptionstoggle",opener.document).hasClass("remove"))$("#composeoptionstoggle").click();(new rcube_splitter({id:"composesplitterv",p1:"#composeview-left",p2:"#composeview-right",orientation:"v",relative:true,start:248,min:170,size:12,render:w})).init()}else if(rcmail.env.action=="list"||!rcmail.env.action){var a=$("#mailpreviewframe").is(":visible");$("#mailpreviewtoggle").addClass(a?"enabled":"closed").click(function(e){k(e);return false});$("#maillistmode").addClass(rcmail.env.threading?"":"selected").click(function(e){A("list");return false});$("#mailthreadmode").addClass(rcmail.env.threading?"selected":"").click(function(e){A("thread");return false});s=new rcube_splitter({id:"mailviewsplitter",p1:"#mailview-top",p2:"#mailview-bottom",orientation:"h",relative:true,start:310,min:150,size:12,offset:4});if(a)s.init();rcmail.addEventListener("setquota",E).addEventListener("enable-command",S).addEventListener("afterimport-messages",q)}else if(rcmail.env.action=="get"){(new rcube_splitter({id:"mailpartsplitterv",p1:"#messagepartheader",p2:"#messagepartcontainer",orientation:"v",relative:true,start:226,min:150,size:12})).init()}if($("#mailview-left").length){(new rcube_splitter({id:"mailviewsplitterv",p1:"#mailview-left",p2:"#mailview-right",orientation:"v",relative:true,start:226,min:150,size:12,callback:g,render:y})).init()}}else if(rcmail.env.task=="settings"){rcmail.addEventListener("init",function(){var e="#settingstabpreferences";if(rcmail.env.action)e="#settingstab"+(rcmail.env.action.indexOf("identity")>0?"identities":rcmail.env.action.replace(/\./g,""));$(e).addClass("selected").children().first().removeAttr("onclick").click(function(){return false})});if(rcmail.env.action=="folders"){(new rcube_splitter({id:"folderviewsplitter",p1:"#folderslist",p2:"#folder-details",orientation:"v",relative:true,start:266,min:180,size:12})).init();new rcube_scroller("#folderslist-content","#folderslist-header","#folderslist-footer");rcmail.addEventListener("setquota",E)}else if(rcmail.env.action=="identities"){(new rcube_splitter({id:"identviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:true,start:266,min:180,size:12})).init()}else if(rcmail.env.action=="responses"){(new rcube_splitter({id:"responseviewsplitter",p1:"#identitieslist",p2:"#identity-details",orientation:"v",relative:true,start:266,min:180,size:12})).init()}else if(rcmail.env.action=="preferences"||!rcmail.env.action){(new rcube_splitter({id:"prefviewsplitter",p1:"#sectionslist",p2:"#preferences-box",orientation:"v",relative:true,start:266,min:180,size:12})).init()}else if(rcmail.env.action=="edit-prefs"){$('<a href="#toggle">&#9660;</a>').addClass("advanced-toggle").appendTo("#preferences-details fieldset.advanced legend");$("#preferences-details fieldset.advanced legend").click(function(e){var t=$(this).hasClass("collapsed"),n=$(".advanced-toggle",this).html(t?"&#9650;":"&#9660;");$(this).toggleClass("collapsed").closest("fieldset").children(".propform").toggle()}).addClass("collapsed")}}else if(rcmail.env.task=="addressbook"){rcmail.addEventListener("afterupload-photo",q).addEventListener("beforepushgroup",F).addEventListener("beforepopgroup",I);if(rcmail.env.action==""){(new rcube_splitter({id:"addressviewsplitterd",p1:"#addressview-left",p2:"#addressview-right",orientation:"v",relative:true,start:226,min:150,size:12,render:y})).init();(new rcube_splitter({id:"addressviewsplitter",p1:"#addresslist",p2:"#contacts-box",orientation:"v",relative:true,start:286,min:270,size:12})).init()}var e=$("#dragcontactmenu");if(e.length){rcmail.gui_object("dragmenu","dragcontactmenu");t.dragmenu=e}}$(".tabbed").each(function(e,t){W(t)});$("select.decorated").each(function(){if(bw.opera){$(this).removeClass("decorated");return}var e=$(this),t=e.parent(),n=Math.max(e.height(),26)-2,r=e.width()-22,i=$("option",this).first().text();if($("option:selected",this).val()!="")i=$("option:selected",this).text();var s=$('<a class="menuselector"><span class="handle">'+i+"</span></a>").css("position","absolute").offset(e.position()).insertAfter(e);s.children().width(r).height(n).css("line-height",n-1+"px");if(t.css("position")!="absolute")t.css("position","relative");e.width(s.width()).change(function(){var e=$("option:selected",this).text();$(this).next().children().text(e)})});var f=$("body > div.minwidth");if(f.length){f.css("min-width",$(".toolbar").width()+$("#quicksearchbar").width()+$("#searchfilter").width()+30)}$(document.body).bind("mouseup",p).bind("keyup",function(e){if(e.keyCode==27){for(var n in t){if(t[n].is(":visible"))T(n,false)}}});$("iframe").load(function(e){try{var t=this.contentDocument?this.contentDocument:this.contentWindow?this.contentWindow.document:null;$(t).mouseup(p)}catch(e){}}).contents().mouseup(p);window.onresize=d;d()}function p(e){var r,i,s=e.target;if(s.className=="inner")s=e.target.parentNode;for(var o in t){i=t[o];r=n[o];if(i.is(":visible")&&s.id!=o+"link"&&s!=i.get(0)&&!r.toggle&&(!r.editable||!C(s,i.get(0)))&&(!r.sticky||!rcube_mouse_is_over(e,i.get(0)))&&!$(s).is(".folder-selector-link")){var u=o+"";window.setTimeout(function(){N(u,false)},10)}}}function d(e){var t=e?10:0;if(rcmail.resize_timeout)window.clearTimeout(rcmail.resize_timeout);rcmail.resize_timeout=window.setTimeout(function(){if(rcmail.env.task=="mail"){if(rcmail.env.action=="show"||rcmail.env.action=="preview")m();else if(rcmail.env.action=="compose")w()}$("body.iframe .footerleft").each(function(){var e=$(this),t=$(document.body),n=e.hasClass("floating"),r=t.outerHeight(true)>$(window).height();if(r!=n){var i=r?"addClass":"removeClass";e[i]("floating");t[i]("floatingbuttons")}})},t)}function v(t){var n=$(t.object).siblings("div");if(n.length)$(t.object).insertBefore(n.first());if(t.type=="error"&&rcmail.env.task!="login"){rcmail.hide_message(t.object);if(r.message_timer){window.clearTimeout(r.message_timer)}if(!r.messagedialog){r.messagedialog=$("<div>").addClass("popupdialog").hide()}var i=t.message,s=function(){r.messagedialog.is(":visible")&&r.messagedialog.dialog("destroy").hide()};if(r.messagedialog.is(":visible"))i=r.messagedialog.html()+"<p>"+t.message+"</p>";r.messagedialog.html(i).dialog({resizable:false,closeOnEscape:true,dialogClass:"popupmessage "+t.type,title:e.errortitle,close:s,position:["center","center"],hide:{effect:"fadeOut"},width:420,minHeight:90}).show();if(t.timeout>0)r.message_timer=window.setTimeout(s,t.timeout)}}function m(){$("#messagecontent").css("top",$("#messageheader").outerHeight()+1+"px");$("#message-objects div a").addClass("button");if(!$("#attachment-list li").length){$("div.rightcol").hide();$("div.leftcol").css("margin-right","0")}}function g(e){}function y(e){}function b(e){if(e.nodeName=="TEXTAREA"){var t=$(e),n=14,r=e.scrollHeight,i=e.value.length>80&&r>n*1.5?2:1;t.css("height",n*i+"px");w()}}function w(){var e=$("#composebody"),t=$("#compose-content"),n=$("#composeview-bottom"),r,i,s,o,u=0,a=300,s=t.height()-n.position().top;o=a-s;u=o>-100?0:40;n.css("height",Math.max(a,s)+"px");t.css("overflow",o>0?"auto":"hidden");r=e.parent().width()-5;i=e.parent().height()-16;e.width(r).height(i);$("#composebody_tbl").width(r+8+"px").height("").css("margin-top","1px");$("#composebody_ifr").width(r+8+"px").height(i-40+"px");$("#googie_edit_layer").height(i+"px")}function E(e){var t=24,n=20,r=e.total?Math.ceil(e.percent/100*n)*t:0;if(e.total&&r==t*n&&e.percent<100)r-=t;$("#quotadisplay").css("background-position","0 -"+r+"px")}function S(e){if(e.command=="reply-list"&&rcmail.env.reply_all_mode==1){var t=rcmail.gettext(e.status?"replylist":"replyall");if(rcmail.env.action=="preview")$("a.button.replyall").attr("title",t);else $("a.button.reply-all").text(t).attr("title",t)}}function x(e,r){var i=t[e]=$("#"+e);i.appendTo(document.body);if(i.length)n[e]=$.extend(n[e]||{},r||{})}function T(e,t,r){if(r||!n[e])x(e,r);var i=N(e,t),r=n[e];if(typeof r.callback=="function")r.callback(i)}function N(e,r){var i=t[e],s=n[e],o=$(s.link?s.link:"#"+e+"link"),u=s.above;if(!i){i=t[e]=$("#"+e);i.appendTo(document.body)}if(!i||!i.length)return false;if(typeof r=="undefined")r=i.is(":visible")?false:true;else if(s.toggle&&r&&i.is(":visible"))r=false;if(r&&o.length){var a=$(document).width()-80,f=40;if(a>300){a=300;f=($(document).width()-a)/2}i.css({left:f,top:50,width:a,height:$(document).height()-100})}i[r?"show":"hide"]();if(bw.ie6&&s.overlap){$("select").css("visibility",r?"hidden":"inherit");$("select",i).css("visibility","inherit")}return r}function C(e,t){while(e.parentNode){if(e.parentNode==t)return true;e=e.parentNode}return false}function k(e){var t=$(e.target),n=$("#mailpreviewframe"),r=!n.is(":visible"),i=s.pos||parseInt(l("mailviewsplitter")||320),o,u,a;n.toggle();t.removeClass().addClass(r?"enabled":"closed");if(r){$("#mailview-top").removeClass("fullheight").css({bottom:"auto"});$("#mailview-bottom").css({height:"auto"}).show();rcmail.env.contentframe="messagecontframe";if(a=rcmail.message_list.get_single_selection())rcmail.show_message(a,false,true);if(s.handle){s.handle.show();s.resize()}else s.init()}else{rcmail.env.contentframe=null;rcmail.show_contentframe(false);$("#mailview-top").addClass("fullheight").css({height:"auto",bottom:"0px"});$("#mailview-bottom").css({top:"auto",height:"0px"}).hide();if(s.handle)s.handle.hide()}if(rcmail.message_list){if(r&&a)rcmail.message_list.scrollto(a);rcmail.message_list.resize()}rcmail.command("save-pref",{name:"preview_pane",value:r?1:0})}function L(){$("#preview-shortheaders").toggle();var e=$("#preview-allheaders").toggle(),t=$("a#previewheaderstoggle");if(e.is(":visible"))t.attr("href","#hide").removeClass("add").addClass("remove");else t.attr("href","#details").removeClass("remove").addClass("add");c("previewheaders",e.is(":visible")?"1":"0")}function A(e){if(rcmail.env.threading!=(e=="thread"))rcmail.set_list_options(null,undefined,undefined,e=="thread"?1:0);$("#maillistmode, #mailthreadmode").removeClass("selected");$("#mail"+e+"mode").addClass("selected")}function O(e){if(e&&e.props&&e.props.menu=="attachmentmenu")N("attachmentmenu");else H()}function M(e){B()}function _(e){if(e&&rcmail.env.search_mods){var n,r,i=t["searchmenu"],s=$('input:checkbox[name="s_mods[]"]',i),o=rcmail.env.mailbox,u=rcmail.env.search_mods;if(rcmail.env.task=="mail"){u=u[o]?u[o]:u["*"];r="text"}else{r="*"}if(u[r])s.map(function(){this.checked=true;this.disabled=this.value!=r});else{s.prop("disabled",false).prop("checked",false);for(n in u)$("#s_mod_"+n).prop("checked",true)}}}function D(e){var t=e.parentNode.id.replace(/^attach/,"");$("#attachmenuopen").unbind("click").attr("onclick","").click(function(e){return rcmail.command("open-attachment",t,this)});$("#attachmenudownload").unbind("click").attr("onclick","").click(function(){rcmail.command("download-attachment",t,this)});n.attachmentmenu.link=e;rcmail.command("menu-open",{menu:"attachmentmenu",id:t})}function P(e){var n,r,s=rcmail.spellcheck_lang(),o=t.spellmenu,u=$("ul",o);if(!u.length){u=$('<ul class="toolbarmenu selectable">');for(i in rcmail.env.spell_langs){r=$("<li>");n=$('<a href="#"></a>').text(rcmail.env.spell_langs[i]).addClass("active").data("lang",i).click(function(){rcmail.spellcheck_lang_set($(this).data("lang"))});n.appendTo(r);r.appendTo(u)}u.appendTo(o)}$("li",u).each(function(){var e=$("a",this);if(e.data("lang")==s)e.addClass("selected");else if(e.hasClass("selected"))e.removeClass("selected")})}function H(){var e=$("#listoptions");if(e.is(":visible")){e.dialog("close");return}$('input[name="sort_col"][value="'+rcmail.env.sort_col+'"]').prop("checked",true);$('input[name="sort_ord"][value="DESC"]').prop("checked",rcmail.env.sort_order=="DESC");$('input[name="sort_ord"][value="ASC"]').prop("checked",rcmail.env.sort_order!="DESC");$('input[name="list_col[]"]').each(function(){$(this).prop("checked",$.inArray(this.value,rcmail.env.coltypes)!=-1)});e.dialog({modal:true,resizable:false,closeOnEscape:true,title:null,close:function(){e.dialog("destroy").hide()},minWidth:500,width:e.width()+25}).show()}function B(){$("#listoptions").dialog("close");var e=$('input[name="sort_col"]:checked').val(),t=$('input[name="sort_ord"]:checked').val(),n=$('input[name="list_col[]"]:checked').map(function(){return this.value}).get();rcmail.set_list_options(n,e,t,rcmail.env.threading)}function j(e){var t,n,r=rcmail.env.task,i=rcmail.env.search_mods,s=rcmail.env.mailbox;if(!i)i={};if(r=="mail"){if(!i[s])i[s]=rcube_clone_object(i["*"]);n=i[s];t="text"}else{n=i;t="*"}if(!e.checked)delete n[e.value];else n[e.value]=1;if(e.value!=t)return;$('input:checkbox[name="s_mods[]"]').map(function(){if(this==e)return;this.checked=true;if(e.checked){this.disabled=true;delete n[this.value]}else{this.disabled=false;n[this.value]=1}})}function F(e){var t=$("#contacts-table"),n=t.parent().css("overflow","hidden");t.clone().css({position:"absolute",top:"0",left:"0",width:t.width()+"px","z-index":10}).appendTo(n).animate({left:-(t.width()+5)+"px"},300,"swing",function(){$(this).remove();n.css("overflow","auto")})}function I(e){var t=$("#contacts-table"),n=t.parent().css("overflow","hidden"),r=t.clone().appendTo(n);t.css({position:"absolute",top:"0",left:-(t.width()+5)+"px",width:t.width()+"px",height:t.height()+"px","z-index":10}).animate({left:"0"},300,"linear",function(){r.remove();$(this).css({position:"relative",left:"0",width:"100%",height:"auto","z-index":1});n.css("overflow","auto")})}function q(){var e=$("#upload-dialog");if(e.is(":visible")){e.dialog("close");return}if(rcmail.env.action=="compose"&&!e.data("extended")){$("<a>").addClass("iconlink add").attr("href","#add").html("Add").appendTo($('input[type="file"]',e).parent()).click(R);e.data("extended",true)}e.dialog({modal:true,resizable:false,closeOnEscape:true,title:e.attr("title"),close:function(){try{$("#upload-dialog form").get(0).reset()}catch(t){}e.dialog("destroy").hide();$("div.addline",e).remove()},width:480}).show();if(!document.all)$("input[type=file]",e).first().click()}function R(e){var t=$(this).parent();var n=t.clone().addClass("addline").insertAfter(t);n.children(".iconlink").click(R);n.children("input").val("");if(!document.all)$("input[type=file]",n).click()}function U(e,t){var n=$("#compose-"+e);if(n.is(":visible"))return;if(o[e]&&!t)$("#_"+e).val(o[e]);n.show();$("#"+e+"-link").hide();w();return false}function z(e){var t=$("#_"+e);o[e]=t.val();t.val("");$("#compose-"+e).hide();$("#"+e+"-link").show();w();return false}function W(e,t){var n=$(e),r=n.get(0).id,i=n.children("fieldset");if(!i.length)return;if(!r){r="rcmtabcontainer";n.attr("id",r)}t=t||0;i.each(function(e){if(e!=t)$(this).hide()});var s=$("<div>").addClass("tabsbar").prependTo(n);i.each(function(e){var n,i,o=$(this),u=o.children("legend");i=$("<a>").text(u.text()).attr("href","#");n=$("<span>").attr({id:"tab"+e,"class":"tablink"}).click(function(){X(r,e);return false});u.remove();o.addClass("tab");if(e==t)n.addClass("selected");n.append(i).appendTo(s)})}function X(e,t){var n=$("#"+e).children("fieldset");n.each(function(e){$(this)[t==e?"show":"hide"]();$("#tab"+e).toggleClass("selected",e==t)});d()}function V(t){var n=$("<iframe>").attr("id","aboutframe").attr("src",rcmail.url("settings/about")).attr("frameborder","0").appendTo(document.body);var r=Math.floor($(window).height()*.75);var i={};var s=$("#supportlink");if(s.length&&(e.supporturl=s.attr("href")))i[s.html()]=function(t){e.supporturl.indexOf("mailto:")<0?window.open(e.supporturl):location.href=e.supporturl};n.dialog({modal:true,resizable:false,closeOnEscape:true,title:t?t.title||t.innerHTML:null,close:function(){n.dialog("destroy").remove()},buttons:i,width:640,height:r}).width(640)}var e={};var t={};var n={forwardmenu:{editable:1},searchmenu:{editable:1,callback:_},attachmentmenu:{},listoptions:{editable:1},dragmenu:{sticky:1},groupmenu:{above:1},mailboxmenu:{above:1},spellmenu:{callback:P},"attachment-form":{editable:1,above:1,toggle:!bw.ie&&!bw.linux},"upload-form":{editable:1,toggle:!bw.ie&&!bw.linux}};var r=this;var s;var o={};var u;this.set=f;this.init=h;this.init_tabs=W;this.show_about=V;this.show_popup=T;this.add_popup=x;this.set_searchmod=j;this.show_uploadform=q;this.show_header_row=U;this.hide_header_row=z;this.update_quota=E;this.get_pref=l;this.save_pref=c;if(window.$&&document.body){var a=l("minimalmode");if(parseInt(a)||a===null&&$(window).height()<850){$(document.body).addClass("minimal")}if(bw.tablet){$("#viewport").attr("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}}}function rcube_scroller(e,t,n){var r=this;this.list=$(e);this.top=$(t);this.bottom=$(n);this.step_size=6;this.step_time=20;this.delay=500;this.top.mouseenter(function(){if(rcmail.drag_active)r.ts=window.setTimeout(function(){r.scroll("down")},r.delay)}).mouseout(function(){if(r.ts)window.clearTimeout(r.ts)});this.bottom.mouseenter(function(){if(rcmail.drag_active)r.ts=window.setTimeout(function(){r.scroll("up")},r.delay)}).mouseout(function(){if(r.ts)window.clearTimeout(r.ts)});this.scroll=function(e){var t=this,n=this.step_size;if(!rcmail.drag_active)return;if(e=="down")n*=-1;this.list.get(0).scrollTop+=n;this.ts=window.setTimeout(function(){t.scroll(e)},this.step_time)}}function rcube_splitter(e){function n(e){if(bw.konq||bw.chrome||bw.safari)document.body.style.webkitUserSelect="none";t.p1pos=t.relative?t.p1.position():t.p1.offset();t.p2pos=t.relative?t.p2.position():t.p2.offset();t.drag_active=true;$(document).bind("mousemove."+this.id,r).bind("mouseup."+this.id,s);$("iframe").each(function(e,t){$("<div>").attr("id","iframe-splitter-fix-"+e).addClass("iframe-splitter-fix").css({background:"#fff",width:t.offsetWidth+"px",height:t.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")})}function r(e){if(!t.drag_active)return false;window.clearTimeout(t.ts);t.ts=window.setTimeout(function(){i(e)},1);return false}function i(e){var n=rcube_event.get_mouse_pos(e);if(t.relative){var r=t.p1.parent().offset();n.x-=r.left;n.y-=r.top}if(t.horizontal){if(n.y-t.halfsize>t.p1pos.top&&n.y+t.halfsize<t.p2pos.top+t.p2.outerHeight()){t.pos=Math.max(t.min,n.y-t.offset);t.resize()}}else{if(n.x-t.halfsize>t.p1pos.left&&n.x+t.halfsize<t.p2pos.left+t.p2.outerWidth()){t.pos=Math.max(t.min,n.x-t.offset);t.resize()}}t.p1pos=t.relative?t.p1.position():t.p1.offset();t.p2pos=t.relative?t.p2.position():t.p2.offset()}function s(e){if(bw.konq||bw.chrome||bw.safari)document.body.style.webkitUserSelect="auto";$(document).unbind("."+t.id);t.drag_active=false;$("div.iframe-splitter-fix").remove();t.set_cookie();if(typeof t.callback=="function")t.callback(t);return bw.safari?true:rcube_event.cancel(e)}function o(e){if(t.horizontal){var n=parseInt(t.p2.parent().outerHeight(),10)-parseInt(t.p2[0].style.top,10)-(bw.ie8?2:0);t.p2.css("height",(n>0?n:0)+"px")}else{var r=parseInt(t.p2.parent().outerWidth(),10)-parseInt(t.p2[0].style.left,10);t.p2.css("width",(r>0?r:0)+"px")}}this.p=e;this.id=e.id;this.horizontal=e.orientation=="horizontal"||e.orientation=="h";this.halfsize=(e.size!==undefined?e.size:10)/2;this.pos=e.start||0;this.min=e.min||20;this.offset=e.offset||0;this.relative=e.relative?true:false;this.drag_active=false;this.render=e.render;this.callback=e.callback;var t=this;rcube_splitter._instances[this.id]=t;this.init=function(){this.p1=$(this.p.p1);this.p2=$(this.p.p2);if(!this.p1.length||!this.p2.length)return;this.p1pos=this.relative?this.p1.position():this.p1.offset();this.p2pos=this.relative?this.p2.position():this.p2.offset();this.handle=$("<div>").attr("id",this.id).attr("unselectable","on").addClass("splitter "+(this.horizontal?"splitter-h":"splitter-v")).appendTo(this.p1.parent()).bind("mousedown",n);if(this.horizontal){var e=this.p1pos.top+this.p1.outerHeight();this.handle.css({left:"0px",top:e+"px"})}else{var t=this.p1pos.left+this.p1.outerWidth();this.handle.css({left:t+"px",top:"0px"})}if(bw.ie)$(window).resize(o);var r=this.get_cookie();if(r&&!isNaN(r)){this.pos=parseFloat(r);this.resize()}else if(this.pos){this.resize();this.set_cookie()}};this.resize=function(){if(this.horizontal){this.p1.css("height",Math.floor(this.pos-this.p1pos.top-this.halfsize)+"px");this.p2.css("top",Math.ceil(this.pos+this.halfsize+2)+"px");this.handle.css("top",Math.round(this.pos-this.halfsize+this.offset)+"px");if(bw.ie){var e=parseInt(this.p2.parent().outerHeight(),10)-parseInt(this.p2.css("top"),10)-(bw.ie8?2:0);this.p2.css("height",(e>0?e:0)+"px")}}else{this.p1.css("width",Math.floor(this.pos-this.p1pos.left-this.halfsize)+"px");this.p2.css("left",Math.ceil(this.pos+this.halfsize)+"px");this.handle.css("left",Math.round(this.pos-this.halfsize+this.offset+3)+"px");if(bw.ie){var t=parseInt(this.p2.parent().outerWidth(),10)-parseInt(this.p2.css("left"),10);this.p2.css("width",(t>0?t:0)+"px")}}this.p2.resize();this.p1.resize();if(this.drag_active){$("iframe").each(function(e,t){var n=$(this).offset();$("#iframe-splitter-fix-"+e).css({top:n.top+"px",left:n.left+"px",width:t.offsetWidth+"px",height:t.offsetHeight+"px"})})}if(typeof this.render=="function")this.render(this)};this.get_cookie=function(){return window.UI?UI.get_pref(this.id):null};this.set_cookie=function(){if(window.UI)UI.save_pref(this.id,this.pos)}}rcube_splitter._instances={};rcube_splitter.get_instance=function(e){return rcube_splitter._instances[e]}